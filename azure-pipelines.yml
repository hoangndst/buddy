trigger:
- main

pool:
  name: mr4x2-pool

jobs:
  - job: lint
    displayName: 'Run linters'
    steps:
      - script: |
          curl -LsSf https://astral.sh/uv/install.sh | sh
          export PATH="$HOME/.local/bin:$PATH"
          uv --version
        displayName: 'Install uv'

      - script: |
          export PATH="$HOME/.local/bin:$PATH"
          uv sync --all-extras --dev
        displayName: 'Install dependencies'

      - script: |
          export PATH="$HOME/.local/bin:$PATH"
          uv run black --check .
        displayName: 'Black format check'

  - job: run_tests
    displayName: 'Run unit tests'
    dependsOn: lint
    steps:
      - script: |
          curl -LsSf https://astral.sh/uv/install.sh | sh
          export PATH="$HOME/.local/bin:$PATH"
          uv --version
        displayName: 'Install uv'

      - script: |
          export PATH="$HOME/.local/bin:$PATH"
          uv sync --all-extras --dev
        displayName: 'Install dependencies'

      - script: |
          export PATH="$HOME/.local/bin:$PATH"
          uv run python -m unittest discover tests
        displayName: 'Run tests'
