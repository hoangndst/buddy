trigger:
- main

pool:
  name: mr4x2-pool

jobs:
  - job: install_dependencies
    steps:
      - task: Bash@3
        displayName: 'Read Python version from .python-version'
        inputs:
          targetType: 'inline'
          script: |
            PYTHON_VERSION=$(cat .python-version | tr -d '\n')
            echo "Python version: $PYTHON_VERSION"
            echo "##vso[task.setvariable variable=PYTHON_VERSION]$PYTHON_VERSION"
      
      - task: UsePythonVersion@0
        displayName: 'Use Python $(PYTHON_VERSION)'
        inputs:
          versionSpec: $(PYTHON_VERSION)

      - script: |
          curl -LsSf https://astral.sh/uv/install.sh | sh
        displayName: 'Install uv'

      - script: |
          uv sync --all-extras --dev
        displayName: 'Install dependencies'

  - job: run_tests
    dependsOn: install_dependencies
    steps:
      - script: |
          python -m test
        displayName: 'Run tests'
